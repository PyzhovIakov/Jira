
#Область ОбработчикиСобытийФормы

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
	АвтоЗаголовок = Ложь;
	Заголовок = ?(ШаблонОповещения,
		 НСтр("ru='Шаблоны e-mail рассылки (Для оповещений)';en='Newsletter Templates (for alerts)'"),
		 НСтр("ru='Шаблоны e-mail рассылки (Для рассылок)';en='Newsletter Templates (For newsletters)'"));
	
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	Если Параметры.Свойство("Отбор") Тогда
		Если Параметры.Отбор.Свойство("ШаблонОповещения")  Тогда
			ШаблонОповещения = Параметры.Отбор.ШаблонОповещения;
			ПолеКомпановкиШаблон = Новый ПолеКомпоновкиДанных("ШаблонОповещения");
			Если Список.Отбор.Элементы.Количество() = 0 Тогда
				ЭлементОтбора = Список.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
				ЭлементОтбора.ЛевоеЗначение = ПолеКомпановкиШаблон;
				ЭлементОтбора.ВидСравнения = ВидСравненияКомпоновкиДанных.Равно;
				ЭлементОтбора.ПравоеЗначение = ШаблонОповещения;
				ЭлементОтбора.Использование = Истина;
			Иначе
				ЕстьОтборШаблон = Ложь;
				Для Каждого ЭлементОтбора Из Список.Отбор.Элементы Цикл
					Если ЭлементОтбора.ЛевоеЗначение = ПолеКомпановкиШаблон Тогда
						ЕстьОтборШаблон = Истина;
						Прервать;
					КонецЕсли;
				КонецЦикла;
				Если НЕ ЕстьОтборШаблон Тогда
					ЭлементОтбора = Список.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
					ЭлементОтбора.ЛевоеЗначение = ПолеКомпановкиШаблон;
					ЭлементОтбора.ВидСравнения = ВидСравненияКомпоновкиДанных.Равно;
					ЭлементОтбора.ПравоеЗначение = ШаблонОповещения;
					ЭлементОтбора.Использование = Истина;
				КонецЕсли;
			КонецЕсли;	
		КонецЕсли;
	КонецЕсли;	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиСобытийЭлементовТаблицыФормыСписок

&НаКлиенте
Процедура СписокПередНачаломДобавления(Элемент, Отказ, Копирование, Родитель, Группа, Параметр)
	
	Если НЕ Копирование И НЕ Группа Тогда
		Отказ = Истина;
		ПараметрыФормы = Новый Структура();
		ПараметрыФормы.Вставить("ШаблонОповещения", ШаблонОповещения);
		ОткрытьФорму("Справочник.CRM_ШаблоныРассылки.ФормаОбъекта", ПараметрыФормы, Элементы.Список);
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти
