
#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	ЗаполнитьСписокДоменов();
	
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиКомандФормы

&НаКлиенте
Процедура ДобавитьДомен(Команда)
	
	Домен = СокрЛП(Домен);
	
	Если СтрДлина(Домен) > 0 Тогда
		Если Лев(Домен, 1) <> "@" Тогда
			Домен = "@" + Домен;
		КонецЕсли;
		Если СписокДоменов.НайтиПоЗначению(Домен) = Неопределено Тогда
			СписокДоменов.Добавить(Домен);
		КонецЕсли;
		Домен = "";
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура КомандаЗакрыть(Команда)
	Закрыть();
КонецПроцедуры

&НаКлиенте
Процедура КомандаГотово(Команда)
	
	СохранитьМассивДоменов(СписокДоменов.ВыгрузитьЗначения());
	Закрыть();
	
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаКлиенте
Процедура ВосстановитьПубличныеДомены(Команда)
	
	МассивПубличныхДоменов = CRM_ОбщегоНазначенияСервер.МассивПубличныхДоменовПоУмолчанию();
	СписокДоменов.ЗагрузитьЗначения(МассивПубличныхДоменов);
	
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьСписокДоменов()
	
	МассивПубличныхДоменов = CRM_ОбщегоНазначенияСервер.МассивПубличныхДоменов();
	СписокДоменов.ЗагрузитьЗначения(МассивПубличныхДоменов);
	
КонецПроцедуры

&НаСервереБезКонтекста
Процедура СохранитьМассивДоменов(МассивДоменов)
	
	Настройки = Новый Структура;
	Настройки.Вставить("МассивДоменов", МассивДоменов);
	
	ХранилищеНастроек = Новый ХранилищеЗначения(Настройки);
	Константы.CRM_ПубличныеПочтовыеДомены.Установить(ХранилищеНастроек);
	
КонецПроцедуры

#КонецОбласти
