
&НаКлиенте
Процедура ПриОткрытии(Отказ)
	Email = "sale@akam.ru";
	
	СформироватьТекстПисьма();
	
КонецПроцедуры

&НаКлиенте
Процедура ОрганизацияПриИзменении(Элемент)
	СформироватьТекстПисьма();
КонецПроцедуры

&НаКлиенте
Процедура СформироватьТекстПисьма()
	ТемаПисьма = "Запрос на получение ключа АКАМ: Модуль ТОРГИ" + ?(ЗначениеЗаполнено(Организация), " от " + Организация, "");
	
	ТекстПисьма = "Здравствуйте, Коллеги!
	|
	|Нас заинтересовало ваше решение «АКАМ: Модуль ТОРГИ для 1С: CRM».
	|Просим предоставить ключ для его активации.
	|
	|Наши данные:
	|Рег. номер: " + РегНомер + "                                       
	|Релиз конфигурации: " + ЗаполнитьИнформациюОРелизеКонфигурации() + "
	|Релиз платформы: " + ЗаполнитьИнформациюОРелизеПлатформы() + "
	|Организация: " + Организация + "
	|ИНН: " + ПолучитьИНН();
	
КонецПроцедуры

&НаСервере
Функция ЗаполнитьИнформациюОРелизеКонфигурации()
	
	Возврат Метаданные.Версия;
	
КонецФункции

&НаКлиенте
Функция ЗаполнитьИнформациюОРелизеПлатформы()
	
	СИ = Новый СистемнаяИнформация; 
	Возврат СИ.ВерсияПриложения;
	
КонецФункции

&НаСервере
Функция ПолучитьИНН()
	Возврат Организация.ИНН;	
КонецФункции

&НаКлиенте
Процедура РегНомерПриИзменении(Элемент)
	СформироватьТекстПисьма();
КонецПроцедуры

&НаСервере
Функция ОтправитьПисьмоНаСервере()
	Письмо = Документы.ЭлектронноеПисьмоИсходящее.СоздатьДокумент();
	Письмо.Автор                    = Пользователи.ТекущийПользователь();
	Письмо.Ответственный            = Пользователи.ТекущийПользователь();
	Письмо.Дата                     = ТекущаяДатаСеанса();
	Письмо.СтатусПисьма=Перечисления.СтатусыИсходящегоЭлектронногоПисьма.Исходящее;
	Письмо.Важность                 = Перечисления.ВариантыВажностиВзаимодействия.Обычная;
	Письмо.Кодировка                = КодировкаТекста.UTF8;
	Письмо.Текст = ТекстПисьма;
	Письмо.ТекстHTML = ТекстПисьма;
	Письмо.Тема = ТемаПисьма;
	СписокПолучателейПисьма = "";
	Получатель=Письмо.ПолучателиПисьма.Добавить();
	Получатель.Адрес = Email;
	Получатель.Представление = Email;
	СписокПолучателейПисьма	= СписокПолучателейПисьма + Email;
	Письмо.СписокПолучателейПисьма =  СписокПолучателейПисьма;
	Письмо.УчетнаяЗапись = УправлениеЭлектроннойПочтой.ПолучитьУчетнуюЗаписьДляОтправкиПоУмолчанию();
	Письмо.ТипТекста = Перечисления.ТипыТекстовЭлектронныхПисем.ПростойТекст;
	Письмо.Записать();
	Возврат Письмо.Ссылка;
КонецФункции

&НаКлиенте
Процедура ОтправитьПисьмо(Команда)
	Письмо =ОтправитьПисьмоНаСервере();
	ПоказатьЗначение(, Письмо);
КонецПроцедуры
