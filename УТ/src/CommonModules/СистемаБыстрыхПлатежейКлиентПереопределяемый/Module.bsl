///////////////////////////////////////////////////////////////////////////////////////////////////////
// Copyright (c) 2024, ООО 1С-Софт
// Все права защищены. Эта программа и сопроводительные материалы предоставляются 
// в соответствии с условиями лицензии Attribution 4.0 International (CC BY 4.0)
// Текст лицензии доступен по ссылке:
// https://creativecommons.org/licenses/by/4.0/legalcode
///////////////////////////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Подсистема "ИнтернетПоддержкаПользователей.СистемаБыстрыхПлатежей.БазоваяФункциональностьСБП".
// ОбщийМодуль.СистемаБыстрыхПлатежейКлиентПереопределяемый.
//
// Переопределяемые клиентские процедуры работы с Системой быстрых платежей:
//  - программное управление настройками подключения.
//
////////////////////////////////////////////////////////////////////////////////

#Область ПрограммныйИнтерфейс

#Область РаботаССообщениями

// Заполняет параметры сообщения электронной почты, отправляемого без шаблона.
// Применяется в случае, если шаблоны сообщений не используются.
// 
// Параметры:
//  ПараметрыСообщения - Структура - Параметры сообщения электронной почты:
//    * Получатель - СписокЗначений - Список адресов электронной почты.
//    * Предмет - Произвольный - Ссылка на основание платежа.
//    * Тема - Строка - Тема сообщения.
//    * Текст - Строка - Текст сообщения.
//  ПараметрыОперации - Структура - Содержит дополнительные параметры для формирования текста сообщения:
//    * НастройкаПодключения - СправочникСсылка.НастройкиПодключенияКСистемеБыстрыхПлатежей -
//      настройка подключения к Системе быстрых платежей.
//    * ПлатежнаяСсылка - Строка - Платежная ссылка, отправляемая в сообщении.
//    * СуммаСсылкиСБП - Число - Сумма платежной ссылки, отправляемой в сообщении.
//
//@skip-warning
Процедура ПриЗаполненииПараметровСообщенияБезШаблонаСБП(ПараметрыСообщения, ПараметрыОперации) Экспорт
	
КонецПроцедуры

#КонецОбласти

#Область НастройкиПодключения

// Вызывается при нажатии на гиперссылку форматированной строки, расположенной в элементе
// ДекорацияДополнительнаяИнформация.
//
// Параметры:
//  Элемент - Элемент - элемент формы;
//  НавигационнаяСсылкаФорматированнойСтроки - Строка - значение гиперссылки форматированной строки.
//    Параметр передается по ссылке.
//  СтандартнаяОбработка - передается признак выполнения стандартной (системной) обработки события.
//  ДанныеФормы - Структура - настройки подключения на форме:
//    * ПараметрыОплатыСБПc2b - Соответствие, Неопределено - содержит настройки выполнения оплаты.
//       Структура параметра соответствует структуре регистра, которая определена
//       в метаданных за исключением полей указанных в настройках в свойстве ИсключаемыеПоля
//       процедуры СистемаБыстрыхПлатежейПереопределяемый.ПриОпределенииНастроекПодключения
//       (см. Настройки.c2b.ОбъектМетаданных).
//    * НастройкаПодключения, Неопределено - СправочникСсылка.НастройкиПодключенияКСистемеБыстрыхПлатежей -
//       настройка выполнения оплаты. При настройке подключения будет возвращено Неопределено,
//       т.к. элемент настройки еще не создан.
//    * Модифицированность - Булево - признак модифицированности формы.
//
//@skip-warning
Процедура ПриОбработкеНавигационнойСсылкиДополнительнойИнформации(
		Элемент,
		НавигационнаяСсылкаФорматированнойСтроки,
		СтандартнаяОбработка,
		ДанныеФормы) Экспорт
	
	
КонецПроцедуры

#КонецОбласти

#Область ФормаПлатежнойСсылкиСБП

// Определяет алгоритм, выполняющийся перед открытием формы подготовки платежной ссылки СБП.
//
Процедура ПередОткрытиемФормыОтправкиПлатежнойСсылки() Экспорт
	
	ОчиститьСообщения();
КонецПроцедуры

// Определяет сумму НДС на основании суммы оплаты и ставки НДС.
//
// Параметры:
//  Параметры - Структура - параметры частичной оплаты:
//    * СтавкаНДС - ОпределяемыйТип.СтавкиНДССБП - ставка НДС, которую установил пользователь;
//    * Сумма - Число - сумма оплаты в Системе быстрых платежей. Сумма, которую необходимо
//      списать со счета покупателя;
//  ДанныеНДС - Структура - параметры НДС:
//    * СуммаНДС - Число - рассчитанная сумма НДС;
//    * ОблагаетсяНДС - Булево - признак использования НДС.
//
// Пример:
//
Процедура ПриОпределенииСуммыНДС(Параметры, ДанныеНДС) Экспорт
	
	
КонецПроцедуры

#КонецОбласти

#Область ФормаОтображенияQRКода

// Определяет алгоритм, выполняющийся при открытии формы QR кода на форме подготовки платежной ссылки СБП.
//
// Параметры:
//  Форма - ФормаКлиентскогоПриложения - форма отображения QR-кода.
//  ДанныеПлатежнойСсылки - Структура - содержит в себе описание платежной ссылки:
//    * ПлатежнаяСсылка - Строка - ссылка сформированная по данным документа операции.
//    * QRКод - ДвоичныеДанные - данные изображения QR-кода.
//    * ОснованиеПлатежа - ОпределяемыйТип.ДокументОперацииСБП - документ, который отражает
//      оплату в информационной базе.
//  ОповещениеПослеЗавершенияНастройкиФормы - ОписаниеОповещения - оповещение,
//    вызывает метод "ПриОтображенииQRКода", рекомендуется использовать для подключения оборудования.
//    Свойство "ДополнительныеПараметры" имеет тип Структура, для передачи параметров в переопределяемый метод
//    СистемаБыстрыхПлатежейКлиентПереопределяемый.ПриОтображенииQRКода.
//
Процедура ПриОткрытииФормыQRКода(
		Форма,
		ДанныеПлатежнойСсылки,
		ОповещениеПослеЗавершенияНастройкиФормы) Экспорт
	
	//++ Локализация
	
	// ПодключаемоеОборудование
	МенеджерОборудованияКлиент.НачатьПодключениеОборудованиеПриОткрытииФормы(ОповещениеПослеЗавершенияНастройкиФормы, Форма, "ДисплейПокупателя");
	// Конец ПодключаемоеОборудование

	//-- Локализация
	
КонецПроцедуры

// Определяет алгоритм, выполняющийся при отображении QR кода на форме подготовки платежной ссылки СБП.
//
// Параметры:
//  ДанныеПлатежнойСсылки - Структура - содержит описание платежной ссылки и основания платежа:
//    * ПлатежнаяСсылка - Строка - ссылка сформированная по данным документа операции.
//    * QRКод - ДвоичныеДанные - данные изображения QR-кода.
//    * ОснованиеПлатежа - ОпределяемыйТип.ДокументОперацииСБП - документ, который отражает
//      оплату в информационной базе.
//  Параметры - Структура - описание параметров переданных из метода
//   СистемаБыстрыхПлатежейКлиентПереопределяемый.ПриОткрытииФормыQRКода.
//
// Пример:
//  Если ОбщегоНазначенияКлиент.ПодсистемаСуществует("ПоддержкаОборудования.ПодключаемоеОборудование.ДисплеиПокупателя") Тогда
//
//     МодульОборудованиеДисплеиПокупателяКлиент = ОбщегоНазначенияКлиент.ОбщийМодуль("ОборудованиеДисплеиПокупателяКлиент");
//
//       Если МодульОборудованиеДисплеиПокупателяКлиент.ПодключенныеДисплеиПокупателяВыводятQRКод() Тогда
//
//         ПараметрыОперации = МодульОборудованиеДисплеиПокупателяКлиент.ПараметрыОперацииДисплейПокупателя();
//         ПараметрыОперации.ЗначениеQRКода = ДанныеПлатежнойСсылки.ПлатежнаяСсылка;
//         ПараметрыОперации.КартинкаQRКода = Base64Строка(ДанныеПлатежнойСсылки.ПлатежнаяСсылка);
//
//         МодульОборудованиеДисплеиПокупателяКлиент.НачатьВыводQRКодаНаДисплейПокупателя(
//           Неопределено,
//           Новый УникальныйИдентификатор,
//           Неопределено,
//           ПараметрыОперации);
//
//         КонецЕсли;
//  КонецЕсли;
//
Процедура ПриОтображенииQRКода(
		ДанныеПлатежнойСсылки,
		Параметры) Экспорт
	
	//++ Локализация
	
	Если ОборудованиеДисплеиПокупателяКлиент.ПодключенныеДисплеиПокупателяВыводятQRКод() Тогда
		РозничныеПродажиКлиентЛокализация.ВывестиQRКодНаДисплейПокупателя(ДанныеПлатежнойСсылки.ПлатежнаяСсылка, 
																		Base64Строка(ДанныеПлатежнойСсылки.ПлатежнаяСсылка));
	КонецЕсли;
	//-- Локализация
	
КонецПроцедуры

// Определяет алгоритм, выполняющийся при нажатии команды на форме QR-кода.
//
// Параметры:
//  Форма - ФормаКлиентскогоПриложения - форма отображения QR-кода.
//  Команда - КомандаФормы - выполняемая команда.
//  ДанныеПлатежнойСсылки - Структура - параметры выполнения команды:
//    * ПлатежнаяСсылка - Строка - ссылка сформированная по данным документа операции.
//    * QRКод - ДвоичныеДанные - данные изображения QR-кода.
//    * ОснованиеПлатежа - ОпределяемыйТип.ДокументОперацииСБП - документ, который отражает
//      оплату в информационной базе.
//
Процедура ПриОбработкеНажатияКоманды(
		Форма,
		Команда,
		ДанныеПлатежнойСсылки) Экспорт
	
	//++ Локализация
	
	Если ОборудованиеДисплеиПокупателяКлиент.ПодключенныеДисплеиПокупателяВыводятQRКод() Тогда
		РозничныеПродажиКлиентЛокализация.ВывестиQRКодНаДисплейПокупателя(ДанныеПлатежнойСсылки.ПлатежнаяСсылка, 
																		Base64Строка(ДанныеПлатежнойСсылки.ПлатежнаяСсылка));
	КонецЕсли;
	//-- Локализация
	
КонецПроцедуры

// Определяет алгоритм, выполняющийся при закрытии формы отображения QR-кода.
//
// Параметры:
//  Форма - ФормаКлиентскогоПриложения - форма отображения QR-кода.
//
Процедура ПриЗакрытииФормыQRКода(Форма) Экспорт
	
КонецПроцедуры

#КонецОбласти

#КонецОбласти
