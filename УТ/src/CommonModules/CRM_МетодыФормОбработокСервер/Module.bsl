
////////////////////////////////////////////////////////////////////////////////
// <Заголовок модуля: краткое описание и условия применения модуля.>
//  
// В данный модуль вынесены методы подсистемы CRM, вызываемые из модулей типовых объектов. 
// Выносить можно только те методы, которые не вызывают стандартные методы типового модуля или обработчики форм. 
// Т.е. вызывают только те методы, что тоже вынесены из типового или не содержат таких вызовов.
// Для каждого объекта необходимо задать свою #Область с именем объекта и модуля, как он называется в метаданных.
////////////////////////////////////////////////////////////////////////////////

#Область ПрограммныйИнтерфейс

#Область Обработка_CRM_Календарь_Форма

// Получить избранных получателей.
// 
// Возвращаемое значение:
//  ТаблицаЗначений - Избранные получатели.
//
Функция ПолучитьИзбранныхПолучателей() Экспорт
	Запрос = Новый Запрос;
	Запрос.УстановитьПараметр("Пользователь", Пользователи.ТекущийПользователь());
	Запрос.Текст = "ВЫБРАТЬ
	               |	CRM_ИзбранныеПолучатели.Получатель КАК Получатель
	               |ИЗ
	               |	РегистрСведений.CRM_ИзбранныеПолучатели КАК CRM_ИзбранныеПолучатели
	               |ГДЕ
	               |	CRM_ИзбранныеПолучатели.Пользователь = &Пользователь
	               |
	               |УПОРЯДОЧИТЬ ПО
	               |	CRM_ИзбранныеПолучатели.Получатель.Наименование";
	Возврат Запрос.Выполнить().Выгрузить().ВыгрузитьКолонку("Получатель");
КонецФункции // ПолучитьИзбранныхПолучателей()

#КонецОбласти

#Область Обработка_CRM_МастерРегистрацииОбращения

// Возвращает пустой признак открытия мастера.
//
// Возвращаемое значение:
//	Число - пустой признак открытия мастера.
//
Функция МастерОткрытИзПусто() Экспорт
	Возврат 0;
КонецФункции

// Возвращает признак открытия мастера из продаж.
//
// Возвращаемое значение:
//	Число - признак открытия мастера из продаж.
//
Функция МастерОткрытИзПродаж() Экспорт
	Возврат 10;
КонецФункции

// Возвращает признак открытия мастера из обращений.
//
// Возвращаемое значение:
//	Число - признак открытия мастера из обращений.
//
Функция МастерОткрытИзОбращений() Экспорт
	Возврат 20;
КонецФункции

#КонецОбласти

#Область Обработка_ГрупповоеИзменениеРеквизитов_ВыбранныеЭлементы

// Процедура - Добавить команды загрузки результата отчета
//
// Параметры:
//  Форма	 - ФормаКлиентскогоПриложения - Передаваемая форма. 
//
Процедура ДобавитьКомандыЗагрузкиРезультатаОтчета(Форма) Экспорт

	Если Форма.Команды.Найти("") <> Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	Команда = Форма.Команды.Добавить("CRM_ЗагрузитьИзРезультатаОтчета");
	Команда.Действие = "Подключаемый_CRM_ЗагрузитьИзРезультатаОтчета";
	Команда.Заголовок = НСтр("ru = 'Загрузить из результата отчета...'");

	ЭлементКомпоновщика = Форма.Элементы.Найти("КомпоновщикНастроекНастройкиОтбор");
	Если ЭлементКомпоновщика = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	Кнопка = Форма.Элементы.Добавить("CRM_ЗагрузитьИзРезультатаОтчета", Тип("КнопкаФормы"),
		 ЭлементКомпоновщика.КоманднаяПанель);
	Кнопка.ИмяКоманды = "CRM_ЗагрузитьИзРезультатаОтчета";
	
КонецПроцедуры

#КонецОбласти

#КонецОбласти
