#Область ОбработчикиСобытийФормы

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	Список.Параметры.УстановитьЗначениеПараметра("ЭтотУзел", ПланыОбмена.CRM_ИнтеграцииСИнтернетМагазинами.ЭтотУзел());
	СписокИнтеграцийСМагазинами();
КонецПроцедуры

#КонецОбласти

#Область ОбработчикиСобытийЭлементовФормы

&НаКлиенте
Процедура СписокПередНачаломДобавления(Элемент, Отказ, Копирование, Родитель, Группа, Параметр)
	
	Отказ = Истина;
	
	ОписаниеОповещения = Новый ОписаниеОповещения("ОткрытьФормуНовойИнтеграции", ЭтотОбъект);
	CRM_ЛицензированиеКлиент.ПроверитьПодключениеОтраслевыхСервисовИОткрыть(ОписаниеОповещения);
	
КонецПроцедуры

&НаКлиенте
Процедура СписокПередНачаломИзменения(Элемент, Отказ)
	Отказ = Не CRM_ЛицензированиеКлиент.ПроверитьПодключениеОтраслевыхСервисовИОткрыть();
КонецПроцедуры

#КонецОбласти

#Область СлужебныеПроцедурыИФункции

&НаКлиенте
Процедура ОткрытьФормуНовойИнтеграции(Результат, ДопПараметр) Экспорт
	ПараметрыФормы = Новый Структура("ТипИнтернетМагазина", "ВКонтакте");
	ОткрытьФорму("ПланОбмена.CRM_ИнтеграцииСИнтернетМагазинами.ФормаОбъекта", ПараметрыФормы, ЭтотОбъект);
КонецПроцедуры

&НаСервере
Процедура СписокИнтеграцийСМагазинами()
	СписокИнтеграций = CRM_ИнтеграцияСИнтернетМагазинами.СписокИнтеграцийСМагазинами();
	Для каждого Интеграция Из СписокИнтеграций Цикл
		СтрокаКартинки = ПоместитьВоВременноеХранилище(Интеграция.Картинка, УникальныйИдентификатор);
		НовЛого = ЛоготипыМагазинов.Добавить();
		НовЛого.ИмяСервиса = Интеграция.Значение;
		НовЛого.Логотип = СтрокаКартинки;
	КонецЦикла;
КонецПроцедуры

#КонецОбласти
